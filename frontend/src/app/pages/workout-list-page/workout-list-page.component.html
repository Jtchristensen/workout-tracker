<div class="page-header">
  <h1>Workouts</h1>
  <div class="actions">
    <a class="btn" routerLink="/workouts/new">Add workout</a>
    <button class="btn secondary" type="button" (click)="refresh()">Refresh</button>
  </div>
</div>

<div class="grid">
  <section class="card">
    <div class="card-header">
      <h2>Calendar</h2>
      <div class="cal-controls">
        <button class="btn secondary" type="button" (click)="prevMonth()">Prev</button>
        <div class="cal-month">{{ monthLabel$ | async }}</div>
        <button class="btn secondary" type="button" (click)="nextMonth()">Next</button>
      </div>
    </div>

    <div class="calendar" *ngIf="calendarDays$ | async as cal">
      <div class="cal-dow" *ngFor="let d of ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']">{{ d }}</div>
      <div
        class="cal-day"
        *ngFor="let day of cal.days"
        [class.outside]="!day.inMonth"
        [class.workout]="day.workedOut"
        [title]="day.ymd + (day.workedOut ? ' â€¢ workout' : '')"
      >
        {{ day.date.getDate() }}
      </div>

      <div class="legend">
        <span class="dot workout"></span> worked out
      </div>
    </div>
  </section>

  <section class="card" *ngIf="logWorkouts$ | async as workouts">
    <div class="card-header">
      <h2>Log</h2>
      <div class="pager">
        <button class="btn secondary" type="button" (click)="prevPage()" [disabled]="!workouts.length">
          Prev
        </button>
        <button class="btn secondary" type="button" (click)="nextPage(workouts.length)" [disabled]="workouts.length < 50">
          Next
        </button>
      </div>
    </div>

    <div *ngIf="workouts.length === 0" class="muted">No workouts yet.</div>

    <div class="table-wrap" *ngIf="workouts.length > 0">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Activity</th>
            <th class="right">Minutes</th>
            <th>Notes</th>
            <th class="right">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let w of workouts; trackBy: trackById">
            <td class="mono">{{ w.workout_date }}</td>
            <td>{{ w.activity }}</td>
            <td class="right mono">{{ w.duration_minutes ?? '' }}</td>
            <td class="notes" [title]="w.notes || ''">{{ w.notes }}</td>
            <td class="right">
              <a class="link" [routerLink]="['/workouts', w.id, 'edit']">Edit</a>
              <button class="link danger" type="button" (click)="deleteWorkout(w)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="muted pager-hint">Showing up to 50 at a time.</div>
  </section>
</div>
